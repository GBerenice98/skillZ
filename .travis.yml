#env:
 # matrix:
 #   secure: FLBGA7zDxOO9p0zyxI5kcHxtCFX0hxwNq1kO0GLSQLuovj9b007aguaI2UhBkCBPlwJ9m8/yhr2Vf+dpCUn7ka7ro5A0qRhhPfs3eTb+qITINMlKOkZNsMI5fuYvwemhPXPDgDjumUsYWuCgj9IiJ9L9DS6Q9WmmyM5qpFTFNSfLmRHwJ9R4einF8Y0V+u2+QgqGSybuSAaokfXz4BUsRTuHpPD50s/0BFORG3+BxQqUcI1JymmygZG9T+3a8087DcVRJw2+536oVa/vRKsKRVQkayI8/Jgy/Qo70vRLB8zACruIg/PNFwtA0hbqB3KfS2FX+s9xah7a/BqTpSYRCbvmGGJFE6u2KpLRmM+Tuderu0h61wjOFZzGJiiFsN6U2SDV3UtDh382K8MLQMyQB9leKBNv3wUFH9x+jsaN5GshEZR1jp6jZgjCp4tR7COMjzXN+8qzMOvb/urqnNr23Ld+M+17YhefKZ9UH1nkgSXheeOjVLp580Yi/hFpuKdCI4KEy5ClWG/4wDoJxwli177JnQ3P9JzAUcjwLvBNSLmmB+FU3q0qCIUnAQUOzC8+752R5wTgmAZngYI89nf2+yOpV8gX9RvolgmvfJbFTBIYorbLhpI8wGeRqk8HgNi4yf/8GwsrjFIOAAaJKjxBGRSxfbDzPBbUBWhg0G5QPlM=
#language: java

addons:
  sonarcloud:
    organization: "riad-lazli"
    token:
      secure: eO9t45RZpLYeAmvTdYpuUa3aRaUg0MzyscbKQHgOd5hbEgvTszxFn+UCFo3lXsi6mE0e8Uk7u55p4h9RZ1SzT9lrasIC8NjW3sF0n5ddiLecmj2XSJRfjp9q1n/Dy6HRsOyi64gfXYRGskR3bAZddLzk1wWB3bEH/fxAe1giJTFjoniOvk1yORufdfbSJ7XI05rbM0nk6HY8bvuWgorZbmTQLZlQ40Sr4W/s0pTLwhwjj2qBJxsLVlQ+YAi4IpzBHVZyRTas65Xhgt6EQNMSttQpwXym8HeAGjonLz7ASdpmiyaaMaSxO2HN2V4e6VeOFdmxcfV+pWFfGDjTSRW1umL0zGuOOaplQLpq/6VcHLZwLwNlwcAiGLyr99ep+MJy2LV3XYjC8/lJQwIUIKf8AuvJ3KNd/GfzNzP+mnOPLUkEuunULnEtCWAvA8RJkFT/JUHf0CrQjukIL3EKBXHeVOqbHdC5ash3coEaq5CGRBo5aJ1nRxknWYwQO0auflM36MB2/4i/mAaWhrPVWE0YSN6Scv5iOSKyWQnnkafvCRxrlR5Y0nYT8NYn+4tVxcXpR/p/eQD2fPl0j1jHLnTOpO1R2CVP1Eeb/Rmu/LIjUE1gHJyjYwJudbxxPFFMjgkyX+zp/GurK++VmLRegKxb03BJ9P0qiUcFO+wqKPAfgrs=
  # encrypted value of your token


sudo: false
before_install:
  - sudo apt-get -y install graphviz
script:
  - ./gradlew check jacocoTestReport coveralls sendCoverageToCodacy
  - bash <(curl -s https://codecov.io/bash)
  - ./gradlew sonarqube
after_success:
  - ./gradlew jar
  - ./gradlew asciidoctor
before_deploy:
  - export VERSION=`./gradlew -q version`
  - export BINDIR="build/libs"
  - export BINFILE="template-java-project-${VERSION}"
  - export DOCDIR="build/docs/asciidocPdf"
  - export DOCFILE="main"
  - mv "${DOCDIR}/${DOCFILE}.pdf" "${DOCDIR}/${DOCFILE}-${VERSION}.pdf"
  - export BINARY="${BINDIR}/${BINFILE}.jar"
  - export DOCUMENTATION="${DOCDIR}/${DOCFILE}-${VERSION}.pdf"
  - echo binary is ${BINARY}
  - echo documentation is ${DOCUMENTATION}
  - |
    if [ $TRAVIS_BRANCH = "develop" ]
    then
      export TRAVIS_TAG=v${VERSION}-SNAPSHOT
    else
      export TRAVIS_TAG=v${VERSION}
    fi
  - |
    if [ $TRAVIS_BRANCH = "develop" ]
    then
      git tag ${TRAVIS_TAG}
      echo tag ${TRAVIS_TAG}
    else
      echo no tag
    fi
deploy:
  - provider: releases
    api_key:
      secure: MnEsOM7EBcWyaPrHXfIJ4+RLMOezxdM8/PqgK3KBBFD9/YDlNITgoAEkCeZDSF0KkgyrvuyPzJXYsj/jUxzMYp7NjxrVwovyTjJu017Bzz5eAuaZpM0OLF/IYlJJuXCaBSYQeGaNlo16l18JhSX5dMC+RF402PxVdyfp4VvpXZ0mo3n9BcbJGy5BFj/pZkssPqmVKCzc2c5dKmOk861Y4ckX0/KlC35S1YolGV1jD4ceZk5qFMU/MKeTkqNMtSbz0bqBxWvR5xdQg3Ri590H32z8vMu1NTKtyLVAoTbEO1dVeiO6MqwMTiJLyN7Nma55yMhiBSYpsmT/9dletVXVl1GfK+gpzs6RE5AOQB+m8g805/XMqrPv5XonOoJ1RleHkPpnNt0kFeb3piCB0hejeVvGkfUvgNfL3LzgcvelMFE2KZ7Zr2EjfyanV24SA2g1VufCvKirlXKiblY3jFxzTAZE8RVPrlIWDtncVmV8IAza/RzCPEOF9t2cSN2o90b2XNr6NfhPVAmXRCw9Wvks602Z1jLSuluyOeVhvKqrdZToKu3lhRGaTkRpJDu9QE4JATrhLQ+gddXkllzU9FUQn2Rdk8TokgS5SYnSef4SX3tIQ7MXvvhQDg+uCOF/wMJecN/hqHX/YDG7Mucix8MGQoU+0wLLRPAj/3KHO2rMcZQ=
    file:
      - ${BINARY}
      - ${DOCUMENTATION}
    skip_cleanup: true
    overwrite: true
    draft: false
    on:
      #branch master
      tags: true
      all_branches: true
    name: $TRAVIS_TAG
  - provider: releases
    api_key:
      secure: MnEsOM7EBcWyaPrHXfIJ4+RLMOezxdM8/PqgK3KBBFD9/YDlNITgoAEkCeZDSF0KkgyrvuyPzJXYsj/jUxzMYp7NjxrVwovyTjJu017Bzz5eAuaZpM0OLF/IYlJJuXCaBSYQeGaNlo16l18JhSX5dMC+RF402PxVdyfp4VvpXZ0mo3n9BcbJGy5BFj/pZkssPqmVKCzc2c5dKmOk861Y4ckX0/KlC35S1YolGV1jD4ceZk5qFMU/MKeTkqNMtSbz0bqBxWvR5xdQg3Ri590H32z8vMu1NTKtyLVAoTbEO1dVeiO6MqwMTiJLyN7Nma55yMhiBSYpsmT/9dletVXVl1GfK+gpzs6RE5AOQB+m8g805/XMqrPv5XonOoJ1RleHkPpnNt0kFeb3piCB0hejeVvGkfUvgNfL3LzgcvelMFE2KZ7Zr2EjfyanV24SA2g1VufCvKirlXKiblY3jFxzTAZE8RVPrlIWDtncVmV8IAza/RzCPEOF9t2cSN2o90b2XNr6NfhPVAmXRCw9Wvks602Z1jLSuluyOeVhvKqrdZToKu3lhRGaTkRpJDu9QE4JATrhLQ+gddXkllzU9FUQn2Rdk8TokgS5SYnSef4SX3tIQ7MXvvhQDg+uCOF/wMJecN/hqHX/YDG7Mucix8MGQoU+0wLLRPAj/3KHO2rMcZQ=
    file:
      - ${BINARY}
      - ${DOCUMENTATION}
    skip_cleanup: true
    overwrite: true
    draft: true
    on:
      branch: develop
      tags: false
    name: $TRAVIS_TAG

cache:
  directories:
    - "$HOME/.sonar/cache"